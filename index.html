<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ARG — Laboratório do Portal</title>
<style>
  :root{--bg:#0e0f13;--card:#0f1720;--accent:#8ad4ff;--muted:#7b8794}
  body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:linear-gradient(180deg,#070709 0%, #0e1220 100%);color:#e6eef8}
  header{padding:24px;text-align:center}
  h1{margin:0;font-size:28px;letter-spacing:1px}
  main{display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:18px;padding:20px;max-width:1200px;margin:0 auto}
  .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);border:1px solid rgba(255,255,255,0.03);padding:18px;border-radius:12px;box-shadow:0 6px 20px rgba(2,6,23,0.6)}
  .mini{font-size:13px;color:var(--muted);margin-bottom:8px}
  button{background:var(--accent);border:none;padding:10px 12px;border-radius:8px;color:#022;padding-left:14px;cursor:pointer;font-weight:600}
  input[type="text"]{padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit;width:100%}
  pre{background:#051226;padding:10px;border-radius:8px;overflow:auto;font-size:13px}
  canvas{background:#05060a;border-radius:8px;display:block;width:100%;height:220px}
  .hint{margin-top:10px;color:#cfeeff;font-size:13px;background:linear-gradient(90deg, rgba(138,212,255,0.06), transparent);padding:8px;border-radius:8px}
  footer{padding:14px;text-align:center;color:var(--muted);font-size:13px}
  small{color:var(--muted)}
  /* Puzzle 1 - hover reveal: secret gradient stop hides hex in CSS comment (for players who inspect styles) */
  .p1 .secret{background:linear-gradient(90deg,#0000 0% , #0000 30%, rgba(138,212,255,0.04) 30%);padding:12px;border-radius:8px}
  .p1 .secret:hover{filter:brightness(1.05);transform:translateY(-2px)}
</style>
</head>
<body>
<header>
  <h1>Arquivo: Laboratório do Portal — Interface de Testes</h1>
  <small>Seja bem-vindo, encontre os códigos e siga as coordenadas!</small>
</header>
<main>
  <!-- PUZZLE 1: CSS / INSPECT ELEMENT -->
  <section class="card p1" id="p1">
    <div class="mini">Enigma 1 — O Sussurro das Camadas</div>
    <h2>Interaja com a caixa; às vezes o que está 'parado' sussurra</h2>
    <div class="secret" title="Passe o mouse!">
      Passe o mouse aqui. Um símbolo antigo aparece quando esta camada se alinha...
    </div>
    <div class="hint">Roleplay: dizem que os guardiões escrevem instruções nas margens das camadas! (inspecione estilos)</div>
  </section>

  <!-- PUZZLE 2: CONSOLE CIPHER -->
  <section class="card" id="p2">
    <div class="mini">Enigma 2 — Vozes no Consolo</div>
    <h2>Abra o console do navegador e leia as mensagens ofuscadas</h2>
    <p>As mensagens parecem aleatórias — decodifique o padrão para achar uma palavra-chave.</p>
    <button id="p2btn">Ver pista no console</button>
    <div class="hint">Roleplay: a IA experimental só fala com quem entende seu tom cryptográfico!</div>
  </section>

  <!-- PUZZLE 3: CANVAS STAR MAP -->
  <section class="card" id="p3">
    <div class="mini">Enigma 3 — Mapa de Estrelas</div>
    <h2>Trace um caminho conectando pontos (clique).</h2>
    <canvas id="starCanvas" width="600" height="320"></canvas>
    <div class="hint">Roleplay: conecte as luzes do céu como se fosse um bordado — aparecerá uma letra!</div>
  </section>

  <!-- PUZZLE 4: IMAGE STEGO (pixel read) -->
  <section class="card" id="p4">
    <div class="mini">Enigma 4 — Tinta que fala</div>
    <h2>Arraste a imagem gerada para o leitor e extraia a mensagem escondida</h2>
    <input type="file" id="imgInput" accept="image/*"><div id="imgResult"></div>
    <div class="hint">Roleplay: um retrato estranho contém marcas que só a luz certa revela!</div>
  </section>

  <!-- PUZZLE 5: LOCALSTORAGE/DATE LOCK -->
  <section class="card" id="p5">
    <div class="mini">Enigma 5 — Cofre do Tempo</div>
    <h2>Insira uma chave; se já tiveres outra pista, ela ajuda a destravar o cofre</h2>
    <input id="p5input" placeholder="digite a chave aqui"/>
    <button id="p5check">Abrir cofre</button>
    <div id="p5out" class="hint" style="margin-top:10px"></div>
  </section>

  <!-- PUZZLE 6: BEEPS / MORSE / AUDIO -->
  <section class="card" id="p6">
    <div class="mini">Enigma 6 — Código das Frequências</div>
    <h2>Ouça a sequência: cada bip é curto/longo — decodifique em morse</h2>
    <button id="playBeep">Tocar sequência</button>
    <p class="hint">Roleplay: alguns símbolos não são visíveis, mas se ouvidos, revelam nomes!</p>
    <div id="p6out" style="margin-top:10px"></div>
  </section>

</main>

<footer>Prototipo ARG — adapte as respostas secretas para sua narrativa</footer>

<script>
/* =========================
   Enigma 1: CSS Hover + Inspect
   - The content message is visible, but the real secret is stored in the style comment below.
   - Players who open devtools and inspect the .p1 .secret rule will find the hex that maps to ASCII!
   ========================= */
(function p1(){
  // intentionally put a secret inside a CSS rule as a comment string
  // NOTE: to read: devtools > inspect element > styles panel > look for the comment
  const style = document.createElement('style');
  style.textContent = `
  /* Guardian note: 53 45 47 52 45 */
  .p1 .secret { /* hex: 53 45 47 52 45 */ }
  `;
  document.head.appendChild(style);
})();

/* =========================
   Enigma 2: Console Cipher
   - Prints obfuscated lines in console; reading ASCII offsets reconstructs the word "LUMEN"
   ========================= */
(function p2(){
  const btn = document.getElementById('p2btn');
  btn.addEventListener('click',()=>{
    console.log("%cA.I. DIÁRIO - ENTRY LOG", "color:#8ad4ff;font-weight:700");
    // push several logs that look random; pattern: base number + index -> char code
    const base = 65; // used to obfuscate
    const offsets = [7, 20, 12, 4, 13]; // will become letters after transformation
    console.log("raw stream:", offsets.join(', '));
    console.log("transform: subtract  (base - x)  then add 1");
    // print helper but not solved
    offsets.forEach((v,i)=>{
      console.log(`chunk ${i}: ${(base - v + 1)}`);
    });
    console.log("%cDICA: some coisas só fazem sentido quando traduzidas como códigos ASCII!", "color:#c0f0ff");
    console.log("%cSe quiser decodificar rápido: escolha (base - chunk + 1) e converta o número em letra ASCII", "color:#bfe7ff");
  });
})();

/* =========================
   Enigma 3: Canvas star map
   - Clicking stars draws connections; if player connects in the right order, a letter traces
   ========================= */
(function p3(){
  const canvas = document.getElementById('starCanvas');
  const ctx = canvas.getContext('2d');
  const w = canvas.width, h = canvas.height;
  const stars = [
    {x:80,y:60},{x:140,y:40},{x:200,y:70},{x:260,y:110},{x:320,y:150},
    {x:390,y:120},{x:460,y:80},{x:520,y:120},{x:480,y:200},{x:360,y:220}
  ];
  function drawStars(){
    ctx.clearRect(0,0,w,h);
    ctx.fillStyle = '#e6eef8';
    ctx.globalAlpha = 0.9;
    stars.forEach(s=>{
      ctx.beginPath();ctx.arc(s.x,s.y,4,0,Math.PI*2);ctx.fill();
    });
  }
  drawStars();
  let path = [];
  canvas.addEventListener('click', (ev)=>{
    const r = canvas.getBoundingClientRect();
    const x = ev.clientX - r.left, y = ev.clientY - r.top;
    // find nearest star within 18px
    let nearest = null, dmin = 999;
    stars.forEach((s,idx)=>{ const d = Math.hypot(s.x-x,s.y-y); if(d<dmin){dmin=d;nearest=idx} });
    if(dmin < 18){
      path.push(nearest);
      redrawPath();
      if(path.length >= 5) checkAnswer();
    }
  });
  function redrawPath(){
    drawStars();
    if(path.length){
      ctx.strokeStyle = '#8ad4ff';
      ctx.lineWidth = 3; ctx.beginPath();
      path.forEach((idx,i)=>{ const s = stars[idx]; if(i===0) ctx.moveTo(s.x,s.y); else ctx.lineTo(s.x,s.y)});
      ctx.stroke();
    }
  }
  function checkAnswer(){
    // correct path (indexes) spells a rough letter when connected: [0,1,2,3,4]
    const correct = JSON.stringify([0,1,2,3,4]);
    if(JSON.stringify(path.slice(0,5))===correct){
      alert("Você traçou a constelação correta! A letra formada: 'A'");
    } else {
      // provide subtle hint
      document.getElementById('starCanvas').style.boxShadow = '0 0 20px rgba(138,212,255,0.06)';
    }
  }
})();

/* =========================
   Enigma 4: Image steganography helper
   - The site can read an uploaded image's pixel channel LSB to reveal a short message
   - To test: use the generator below to create a test image with hidden text, or let master embed image externally.
   ========================= */
(function p4(){
  const input = document.getElementById('imgInput');
  const out = document.getElementById('imgResult');

  // helper: embed and extract simple LSB message into a canvas (for gm/editor)
  function extractLSBMessage(img){
    const c = document.createElement('canvas');
    c.width = img.width; c.height = img.height;
    const ctx = c.getContext('2d'); ctx.drawImage(img,0,0);
    const d = ctx.getImageData(0,0,c.width,c.height).data;
    // we'll read first 16*8 bits as length, then that many*8 bits as message
    function bitAt(i){ return d[i] & 1; } // LSB of red channel index
    const bits = [];
    for(let i=0;i< (c.width*c.height)*4; i+=4){ bits.push(bitAt(i)); if(bits.length>20000) break; }
    // read length (first 16 bits)
    const lenBits = bits.slice(0,16);
    const len = parseInt(lenBits.join(''),2);
    if(isNaN(len) || len<=0 || len>1000) return null;
    const msgBits = bits.slice(16,16 + len*8);
    const chars = [];
    for(let i=0;i<msgBits.length;i+=8){
      const byte = msgBits.slice(i,i+8).join('');
      chars.push(String.fromCharCode(parseInt(byte,2)));
    }
    return chars.join('');
  }

  input.addEventListener('change', (e)=>{
    const f = e.target.files?.[0];
    if(!f) return;
    const url = URL.createObjectURL(f);
    const img = new Image();
    img.onload = ()=>{
      const msg = extractLSBMessage(img);
      out.innerHTML = '';
      out.appendChild(img);
      const p = document.createElement('div');
      p.style.marginTop = '8px';
      if(msg) p.innerHTML = `<strong>Mensagem encontrada:</strong> <code>${msg}</code>`;
      else p.innerHTML = `<strong>Nenhuma mensagem encontrada</strong> — tente outra imagem ou gere uma com o esteganógrafo do servidor!`;
      out.appendChild(p);
    };
    img.src = url;
  });

})();

/* =========================
   Enigma 5: LocalStorage time-lock + key chaining
   - If user has a previous clue 'LUMEN' stored, unlock secret; otherwise store a hint fragment
   ========================= */
(function p5(){
  const inpt = document.getElementById('p5input');
  const btn = document.getElementById('p5check');
  const out = document.getElementById('p5out');

  // Seed a fragment so players who explored earlier could find it
  if(!localStorage.getItem('fragment')){
    localStorage.setItem('fragment', JSON.stringify({part:"GLI", ts:Date.now()}));
  }

  btn.addEventListener('click', ()=>{
    const val = inpt.value.trim().toUpperCase();
    const fragment = JSON.parse(localStorage.getItem('fragment')||'{}');
    // accepted key example: LUMEN (derived from puzzle 2)
    if(val === "LUMEN"){
      // unlock final secret (example: coordinates/code)
      out.innerHTML = "<strong>COFRE ABERTO:</strong> coordenada final - 42.7N / 13.2E -> código 'VITRA'";
      // store progress
      localStorage.setItem('unlocked', 'VITRA');
    } else {
      out.innerHTML = "Chave inválida! Porém, um fragmento foi guardado no seu dispositivo: " + (fragment.part||'??');
    }
  });
})();

/* =========================
   Enigma 6: Morse-like beeps
   - Plays a sequence of short/long beeps. The transcript is displayed too (so players can use both hearing and visual)
   ========================= */
(function p6(){
  const seq = [0,0,1,0,1,1,0]; // 0 short, 1 long -> represents e.g. ".-..-.."
  const playBtn = document.getElementById('playBeep');
  const out = document.getElementById('p6out');
  let audioCtx;
  function beep(lengthMs){
    if(!audioCtx) audioCtx = new (window.AudioContext||window.webkitAudioContext)();
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.type = 'sine'; o.frequency.value = 880;
    o.connect(g); g.connect(audioCtx.destination);
    o.start();
    g.gain.setValueAtTime(0.0001, audioCtx.currentTime);
    g.gain.exponentialRampToValueAtTime(0.3, audioCtx.currentTime + 0.01);
    setTimeout(()=>{ g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.01); o.stop(); }, lengthMs);
  }
  playBtn.addEventListener('click', async ()=>{
    // play sequence with spacing
    out.innerHTML = "Sequência (visual): " + seq.map(s=> s?'-':'·').join(' ');
    for(let i=0;i<seq.length;i++){
      beep(seq[i]?400:120);
      await new Promise(r=>setTimeout(r, seq[i]?520:170));
    }
    // parted hint
    out.innerHTML += "<br><small>Transcrição: · · - · - - ·  (converte para Morse -> 'L' ou combine com as outras letras!)</small>";
  });
})();
</script>
